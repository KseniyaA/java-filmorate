DROP ALL OBJECTS;

CREATE TABLE IF NOT EXISTS rating (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR(10),
	CONSTRAINT rating_pk PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS film (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR(100) NOT NULL,
	release_date DATE,
	description VARCHAR(200),
	duration INTEGER,
	rate INTEGER,
	rating_id INTEGER REFERENCES rating (id) ON DELETE CASCADE,
	CONSTRAINT films_pk PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS genre (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR(50),
	CONSTRAINT genre_pk PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS film_genre (
	film_id INTEGER REFERENCES film (id) ON DELETE CASCADE,
	genre_id INTEGER REFERENCES genre (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS users (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY,
	email VARCHAR(100) NOT NULL,
	login VARCHAR(50) NOT NULL,
	name VARCHAR(100) NOT NULL,
	birthday date,
	CONSTRAINT users_pk PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS favorite_films (
	film_id INTEGER REFERENCES film (id) ON DELETE CASCADE,
	user_id INTEGER REFERENCES users (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS friendship (
	user_from INTEGER REFERENCES users (id) ON DELETE CASCADE,
	user_to INTEGER REFERENCES users (id) ON DELETE CASCADE,
	is_confirmed BOOLEAN NOT NULL
);
